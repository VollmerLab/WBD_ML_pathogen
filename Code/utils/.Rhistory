.keep = 'unused') %>%
pivot_wider(names_from = taxon_level, values_from = name) %>%
relocate(asv_id:FDR, .after = Species) %>%
select(-FDR) %>%
full_join(field_out2,
by = 'asv_id') %>%
left_join(tank_out,
by = 'asv_id') %>%
select(-PostvPreH) %>%
rename(ID = asv_id,
Field = estimate,
Disease = DvH,
Exposure = DvN,
'After Before' = PostvPreD,
'Median Rank' = median_rank) %>%
mutate(across(where(is.character), ~str_replace_all(., '\\+-', ' ± '))) %>%
relocate(`After Before`, .after = `Field`) %>%
relocate(`Exposure`, .after = `After Before`) %>%
mutate(across(`After Before`:DHvNH, ~if_else(str_detect(., '\\*'), str_remove_all(., ' \\*'), 'n/s'))) %>%
select(-Phylum:-Class, -DDvNH, -DHvNH) %>%
relocate(Order:Species, .after = likely_type) %>%
mutate(across(everything(), ~replace_na(., '-')))
asv_table
asv_table <- select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>%
mutate(taxon_level = str_to_sentence(taxon_level),
name = if_else(confidence < 80, '', name),
# name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>%
pivot_wider(names_from = taxon_level, values_from = name) %>%
relocate(asv_id:FDR, .after = Species) %>%
select(-FDR) %>%
full_join(field_out2,
by = 'asv_id') %>%
left_join(tank_out,
by = 'asv_id') %>%
select(-PostvPreH) %>%
rename(ID = asv_id,
Field = estimate,
Disease = DvH,
Exposure = DvN,
'After Before' = PostvPreD,
'Median Rank' = median_rank) %>%
mutate(across(where(is.character), ~str_replace_all(., '\\+-', ' ± '))) %>%
relocate(`After Before`, .after = `Field`) %>%
relocate(`Exposure`, .after = `After Before`) %>%
mutate(across(`After Before`:DHvNH, ~if_else(str_detect(., '\\*'), str_remove_all(., ' \\*'), 'n/s'))) %>%
select(-Phylum:-Class, -DDvNH, -DHvNH) %>%
relocate(Order:Species, .after = likely_type) %>%
mutate(across(everything(), ~replace_na(., '-')),
Species = if_else(Species == '' & Genus != '', str_c(Genus, ' sp.'), Species))
asv_table
asv_table <- select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>%
mutate(taxon_level = str_to_sentence(taxon_level),
name = if_else(confidence < 80, '', name),
# name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>%
pivot_wider(names_from = taxon_level, values_from = name) %>%
relocate(asv_id:FDR, .after = Species) %>%
select(-FDR) %>%
full_join(field_out2,
by = 'asv_id') %>%
left_join(tank_out,
by = 'asv_id') %>%
select(-PostvPreH) %>%
rename(ID = asv_id,
Field = estimate,
Disease = DvH,
Exposure = DvN,
'After Before' = PostvPreD,
'Median Rank' = median_rank) %>%
mutate(across(where(is.character), ~str_replace_all(., '\\+-', ' ± '))) %>%
relocate(`After Before`, .after = `Field`) %>%
relocate(`Exposure`, .after = `After Before`) %>%
mutate(across(`After Before`:DHvNH, ~if_else(str_detect(., '\\*'), str_remove_all(., ' \\*'), 'n/s'))) %>%
select(-Phylum:-Class, -DDvNH, -DHvNH) %>%
relocate(Order:Species, .after = likely_type) %>%
mutate(across(everything(), ~replace_na(., '-')),
Species = if_else(Species == '' & Genus != '', str_c(Genus, ' sp.'), Species)) %>% View
asv_table <- select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>%
mutate(taxon_level = str_to_sentence(taxon_level),
name = if_else(confidence < 80, '', name),
# name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>%
pivot_wider(names_from = taxon_level, values_from = name) %>%
relocate(asv_id:FDR, .after = Species) %>%
select(-FDR) %>%
full_join(field_out2,
by = 'asv_id') %>%
left_join(tank_out,
by = 'asv_id') %>%
select(-PostvPreH) %>%
rename(ID = asv_id,
Field = estimate,
Disease = DvH,
Exposure = DvN,
'After Before' = PostvPreD,
'Median Rank' = median_rank) %>%
mutate(across(where(is.character), ~str_replace_all(., '\\+-', ' ± '))) %>%
relocate(`After Before`, .after = `Field`) %>%
relocate(`Exposure`, .after = `After Before`) %>%
mutate(across(`After Before`:DHvNH, ~if_else(str_detect(., '\\*'), str_remove_all(., ' \\*'), 'n/s'))) %>%
select(-Phylum:-Class, -DDvNH, -DHvNH) %>%
relocate(Order:Species, .after = likely_type) %>%
mutate(across(everything(), ~replace_na(., '-')),
Species = if_else(Species == '' & Genus != '', str_c(Genus, ' sp.'), Species)) %>%
select(-Genus)
asv_table
library(tidyverse)
library(emmeans)
alpha <- 0.05
taxonomy <- read_csv('../../intermediate_files/taxonomy.csv.gz',
show_col_types = FALSE) %>%
mutate(across(everything(), ~str_replace_na(., '')))
taxonom_confidence <- read_csv('../../intermediate_files/update_taxonomy.csv',
show_col_types = FALSE)
ml_model_out <- read_csv('../../Results/asv_importance.csv.gz', show_col_types = FALSE) %>%
left_join(taxonomy, ., by = 'asv_id') %>%
rename(FDR = p_adjust) %>%
# group_by(family, genus) %>%
# filter(any(FDR < 0.05)) %>%
# ungroup %>%
filter(FDR < 0.05) %>%
arrange(domain, phylum, class, order, family, genus, median_rank) %>%
select(-contains('method'), -contains('alternative'), -contains('domain')) %>%
relocate(asv_id, .after = 'genus') %>%
rename_with(~str_remove(., 'base_') %>%
str_replace_all(c('forest' = 'Random Forest',
'knn' = 'KNN',
'lasso' = 'LASSO',
'mlp' = 'MLP',
'null' = 'Null',
'pls' = 'PLS',
'svmLinear' = 'SVM'))) %>%
mutate(#p.value = scales::pvalue(p.value, 0.0001),
FDR = scales::pvalue(FDR, 0.001)) %>%
arrange(median_rank)
field_asv_models <- read_rds('../../intermediate_files/field_asv_models.rds.gz') %>%
filter(asv_id %in% ml_model_out$asv_id) %>%
rowwise %>%
mutate(pct_site = summary(model)$varcor %>%
as_tibble() %>%
mutate(pct_var = vcov / sum(vcov)) %>%
filter(grp == 'site') %>%
pull(pct_var)) %>%
ungroup
field_out <- field_asv_models %>%
select(asv_id, tp_contrasts) %>%
unnest(tp_contrasts) %>%
group_by(year, season) %>%
mutate(fdr = p.adjust(p.value, 'fdr')) %>%
ungroup %>%
mutate(estimate = str_c(round(estimate, 1), round(SE, 2), sep = '+-'),
estimate = if_else(fdr < 0.05, str_c(estimate, ' *'), estimate),
.keep = 'unused') %>%
select(-df, -t.ratio, -contains('p.value')) %>%
pivot_wider(names_from = c(year, season),
values_from = estimate) %>%
relocate(`2017_S`, .after = `2016_W`) %>%
select(-contrast)
field_out2 <- read_rds('../../intermediate_files/field_asv_models.rds.gz') %>%
filter(asv_id %in% ml_model_out$asv_id) %>%
rowwise %>%
select(asv_id, model, tp_contrasts) %>%
unnest(tp_contrasts) %>%
group_by(year, season) %>%
mutate(fdr = p.adjust(p.value, 'fdr')) %>%
select(-contrast, -df, -t.ratio,
-contains('p.value'), -SE) %>%
ungroup %>%
group_by(asv_id) %>%
summarise(model = unique(model),
all_pos = all(estimate > 0),
all_neg = all(estimate < 0),
sig = all(fdr < alpha),
.groups = 'rowwise') %>%
mutate(emmeans(model, ~health) %>%
contrast('pairwise') %>%
as_tibble() %>%
select(estimate, SE),
.keep = 'unused') %>%
ungroup %>%
mutate(estimate = str_c(round(estimate, 1), round(SE, 2), sep = '+-'),
estimate = if_else((sig & all_pos) | (sig & all_neg),
estimate, 'n/c'),
.keep = 'unused')
tank_out <- read_rds('../../intermediate_files/tank_asv_models.rds.gz') %>%
filter(asv_id %in% ml_model_out$asv_id) %>%
inner_join(mutate(field_asv_models, across(contains('p.within'), ~p.adjust(., method = 'fdr'))) %>%
filter_at(vars(contains('p.within')), all_vars(. < alpha)) %>%
select(asv_id),
by = 'asv_id') %>%
select(asv_id, tank_posthoc) %>%
unnest(tank_posthoc) %>%
group_by(contrast) %>%
mutate(fdr = p.adjust(p.value, 'fdr')) %>%
ungroup %>%
mutate(estimate = str_c(round(estimate, 1), round(std.error, 2), sep = '+-'),
estimate = if_else(fdr < 0.05, str_c(estimate, ' *'), estimate),
.keep = 'unused') %>%
select(asv_id, contrast, estimate) %>%
pivot_wider(names_from = c(contrast),
values_from = estimate) %>%
mutate(likely_type = case_when(str_detect(DDvDH, '\\*') &
str_detect(DvH, '\\*') &
str_detect(PostvPreD, '\\*') ~ 'Pathogen',
str_detect(DvN, '\\*') &
str_detect(PostvPreD, '\\*') ~ 'Opportunist',
TRUE ~ 'Commensalist'))
asv_table_supplement <- select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>%
mutate(taxon_level = str_to_sentence(taxon_level),
name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>%
pivot_wider(names_from = taxon_level, values_from = name) %>%
relocate(asv_id:FDR, .after = Species) %>%
full_join(field_out,
by = 'asv_id') %>%
relocate(`2016_W`, .before = `2016_S`) %>%
relocate(`2017_W`, .before = `2017_S`) %>%
left_join(tank_out,
by = 'asv_id') %>%
relocate(`2016_W`, .before = `2016_S`) %>%
relocate(`2017_W`, .before = `2017_S`) %>%
rename(ID = asv_id) %>%
mutate(across(where(is.character), ~str_replace_all(., '\\+-', ' ± '))) %>%
rename('Median Rank' = median_rank) %>%
relocate(`PostvPreD`, .after = `2017_S`) %>%
relocate(`PostvPreH`, .after = `2017_S`) %>%
relocate(`DvN`, .after = `PostvPreD`)
asv_table_supplement
write_csv(asv_table_supplement, '../../Results/Table45_asv_table_supplement.csv')
asv_table <- select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>%
mutate(taxon_level = str_to_sentence(taxon_level),
name = if_else(confidence < 80, '', name),
# name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>%
pivot_wider(names_from = taxon_level, values_from = name) %>%
relocate(asv_id:FDR, .after = Species) %>%
select(-FDR) %>%
full_join(field_out2,
by = 'asv_id') %>%
left_join(tank_out,
by = 'asv_id') %>%
select(-PostvPreH) %>%
rename(ID = asv_id,
Field = estimate,
Disease = DvH,
Exposure = DvN,
'After Before' = PostvPreD,
'Median Rank' = median_rank) %>%
mutate(across(where(is.character), ~str_replace_all(., '\\+-', ' ± '))) %>%
relocate(`After Before`, .after = `Field`) %>%
relocate(`Exposure`, .after = `After Before`) %>%
mutate(across(`After Before`:DHvNH, ~if_else(str_detect(., '\\*'), str_remove_all(., ' \\*'), 'n/s'))) %>%
select(-Phylum:-Class, -DDvNH, -DHvNH) %>%
relocate(Order:Species, .after = likely_type) %>%
mutate(across(everything(), ~replace_na(., '-')),
Species = if_else(Species == '' & Genus != '', str_c(Genus, ' sp.'), Species)) %>%
select(-Genus)
asv_table
View(asv_table)
taxonomy
View(taxonomy)
select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>% View()
mutate(taxon_level = str_to_sentence(taxon_level),
name = if_else(confidence < 80, '', name),
# name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>% View
asv_table <- select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>%
mutate(taxon_level = str_to_sentence(taxon_level),
name = if_else(confidence < 80, '', name),
# name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>% View
asv_table <- select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>%
mutate(taxon_level = str_to_sentence(taxon_level),
confidence = replace_na(confidence, 80),
name = if_else(confidence < 80, '', name),
# name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>% View
asv_table <- select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>%
mutate(taxon_level = str_to_sentence(taxon_level),
confidence = replace_na(confidence, 80),
name = if_else(confidence < 80, '', name),
# name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>%
pivot_wider(names_from = taxon_level, values_from = name) %>%
relocate(asv_id:FDR, .after = Species) %>%
select(-FDR) %>%
full_join(field_out2,
by = 'asv_id') %>%
left_join(tank_out,
by = 'asv_id') %>%
select(-PostvPreH) %>%
rename(ID = asv_id,
Field = estimate,
Disease = DvH,
Exposure = DvN,
'After Before' = PostvPreD,
'Median Rank' = median_rank) %>%
mutate(across(where(is.character), ~str_replace_all(., '\\+-', ' ± '))) %>%
relocate(`After Before`, .after = `Field`) %>%
relocate(`Exposure`, .after = `After Before`) %>%
mutate(across(`After Before`:DHvNH, ~if_else(str_detect(., '\\*'), str_remove_all(., ' \\*'), 'n/s'))) %>%
select(-Phylum:-Class, -DDvNH, -DHvNH) %>%
relocate(Order:Species, .after = likely_type) %>%
mutate(across(everything(), ~replace_na(., '-')),
Species = if_else(Species == '' & Genus != '', str_c(Genus, ' sp.'), Species)) %>%
select(-Genus)
View(asv_table)
asv_table <- select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>%
mutate(taxon_level = str_to_sentence(taxon_level),
name = case_when(is.na(confidence) ~ name,
confidence < 80 ~ '',
TRUE ~ name),
# name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>%
pivot_wider(names_from = taxon_level, values_from = name) %>%
relocate(asv_id:FDR, .after = Species) %>%
select(-FDR) %>%
full_join(field_out2,
by = 'asv_id') %>%
left_join(tank_out,
by = 'asv_id') %>%
select(-PostvPreH) %>%
rename(ID = asv_id,
Field = estimate,
Disease = DvH,
Exposure = DvN,
'After Before' = PostvPreD,
'Median Rank' = median_rank) %>%
mutate(across(where(is.character), ~str_replace_all(., '\\+-', ' ± '))) %>%
relocate(`After Before`, .after = `Field`) %>%
relocate(`Exposure`, .after = `After Before`) %>%
mutate(across(`After Before`:DHvNH, ~if_else(str_detect(., '\\*'), str_remove_all(., ' \\*'), 'n/s'))) %>%
select(-Phylum:-Class, -DDvNH, -DHvNH) %>%
relocate(Order:Species, .after = likely_type) %>%
mutate(across(everything(), ~replace_na(., '-')),
Species = if_else(Species == '' & Genus != '', str_c(Genus, ' sp.'), Species)) %>%
select(-Genus)
asv_table
View(asv_table)
write_csv(asv_table, '../../Results/Table45_asv_table.csv')
asv_table <- select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>%
mutate(taxon_level = str_to_sentence(taxon_level),
name = case_when(is.na(confidence) ~ name,
confidence < 80 ~ '',
TRUE ~ name),
# name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>%
pivot_wider(names_from = taxon_level, values_from = name) %>%
relocate(asv_id:FDR, .after = Species) %>%
select(-FDR) %>%
full_join(field_out2,
by = 'asv_id') %>%
left_join(tank_out,
by = 'asv_id') %>%
select(-PostvPreH) %>%
rename(ID = asv_id,
Field = estimate,
Disease = DvH,
Exposure = DvN,
'After Before' = PostvPreD,
'Median Rank' = median_rank) %>%
mutate(across(where(is.character), ~str_replace_all(., '\\+-', ' ± '))) %>%
relocate(`After Before`, .after = `Field`) %>%
relocate(`Exposure`, .after = `After Before`) %>%
mutate(across(`After Before`:DHvNH, ~if_else(str_detect(., '\\*'), str_remove_all(., ' \\*'), 'n/s'))) %>%
select(-Phylum:-Class, -DDvNH, -DHvNH) %>%
relocate(Order:Species, .after = likely_type) %>%
mutate(across(everything(), ~replace_na(., '-')),
Species = if_else(Species == '' & Genus != '', str_c(Genus, ' sp.'), Species),
most_likely = if_else(most_likely == 'Commensalist', '-', most_likely)) %>%
select(-Genus)
asv_table <- select(ml_model_out, phylum:species,
asv_id, median_rank, FDR) %>%
relocate(`asv_id`, .after = `species`) %>%
left_join(select(taxonom_confidence, asv_id, ends_with('confidence')) %>%
select(-domain_confidence),
by = 'asv_id') %>%
rename_with(~str_c(., '_name'), .cols = phylum:species) %>%
pivot_longer(cols = c(ends_with('name'), ends_with('confidence')),
names_to = c('taxon_level', '.value'),
names_pattern = '(.*)_(.*)') %>%
mutate(taxon_level = str_to_sentence(taxon_level),
name = case_when(is.na(confidence) ~ name,
confidence < 80 ~ '',
TRUE ~ name),
# name = str_c(name, ' (', scales::percent(confidence, scale = 1), ')'),
.keep = 'unused') %>%
pivot_wider(names_from = taxon_level, values_from = name) %>%
relocate(asv_id:FDR, .after = Species) %>%
select(-FDR) %>%
full_join(field_out2,
by = 'asv_id') %>%
left_join(tank_out,
by = 'asv_id') %>%
select(-PostvPreH) %>%
rename(ID = asv_id,
Field = estimate,
Disease = DvH,
Exposure = DvN,
'After Before' = PostvPreD,
'Median Rank' = median_rank) %>%
mutate(across(where(is.character), ~str_replace_all(., '\\+-', ' ± '))) %>%
relocate(`After Before`, .after = `Field`) %>%
relocate(`Exposure`, .after = `After Before`) %>%
mutate(across(`After Before`:DHvNH, ~if_else(str_detect(., '\\*'), str_remove_all(., ' \\*'), 'n/s'))) %>%
select(-Phylum:-Class, -DDvNH, -DHvNH) %>%
relocate(Order:Species, .after = likely_type) %>%
mutate(across(everything(), ~replace_na(., '-')),
Species = if_else(Species == '' & Genus != '', str_c(Genus, ' sp.'), Species),
likely_type = if_else(likely_type == 'Commensalist', '-', likely_type)) %>%
select(-Genus)
write_csv(asv_table, '../../Results/Table45_asv_table.csv')
